<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="https://myblog-1258449291.cos.ap-beijing.myqcloud.com/wukong.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="https://myblog-1258449291.cos.ap-beijing.myqcloud.com/32_32_wukong.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="https://myblog-1258449291.cos.ap-beijing.myqcloud.com/16_16_wukong.jpg">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"oysz2016.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.9.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":true,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>
<meta name="description" content="可视化网络模型&amp;emsp;&amp;emsp;Caffe目前有两种常用的可视化模型方式：  使用Netscope在线可视化 Caffe代码包内置的draw_net.py文件可以可视化网络模型">
<meta property="og:type" content="article">
<meta property="og:title" content="Caffe版Faster R-CNN可视化——网络模型,图像特征,Loss图,PR曲线">
<meta property="og:url" content="https://oysz2016.github.io/post/79a2296e.html">
<meta property="og:site_name" content="冲弱&#39;s Blog">
<meta property="og:description" content="可视化网络模型&amp;emsp;&amp;emsp;Caffe目前有两种常用的可视化模型方式：  使用Netscope在线可视化 Caffe代码包内置的draw_net.py文件可以可视化网络模型">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/4/27/163055f07a98ecf7?w=1913&amp;h=891&amp;f=png&amp;s=117701">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/4/27/163055f0793044ea?w=654&amp;h=1669&amp;f=png&amp;s=95256">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/4/27/163055f07a3eac7e?w=466&amp;h=357&amp;f=jpeg&amp;s=27803">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/4/27/163055f07a4a0941?w=1000&amp;h=1000&amp;f=jpeg&amp;s=168164">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/4/27/163055f0795032db?w=1000&amp;h=1000&amp;f=jpeg&amp;s=314989">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/4/27/163055f07aab31b9?w=1920&amp;h=1080&amp;f=png&amp;s=1096956">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/4/27/163055f0a7aac1ec?w=1920&amp;h=1080&amp;f=png&amp;s=1019414">
<meta property="og:image" content="https://myblog-1258449291.cos.ap-beijing.myqcloud.com/Blog/%E6%97%A5%E5%BF%97%E5%9B%BE%E7%89%87.png-chuli">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/4/27/163055f0c90ea778?w=800&amp;h=596&amp;f=png&amp;s=20463">
<meta property="og:image" content="https://blog-1258449291.cos.ap-chengdu.myqcloud.com/%E5%B0%8F%E4%B9%A6%E5%8C%A0/1552801555033.jpg">
<meta property="article:published_time" content="2018-04-27T04:35:20.661Z">
<meta property="article:modified_time" content="2019-03-17T05:48:34.450Z">
<meta property="article:author" content="冲弱">
<meta property="article:tag" content="深度学习">
<meta property="article:tag" content="卷积神经网络">
<meta property="article:tag" content="Faster R-CNN">
<meta property="article:tag" content="可视化">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://user-gold-cdn.xitu.io/2018/4/27/163055f07a98ecf7?w=1913&amp;h=891&amp;f=png&amp;s=117701">


<link rel="canonical" href="https://oysz2016.github.io/post/79a2296e.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://oysz2016.github.io/post/79a2296e.html","path":"post/79a2296e.html","title":"Caffe版Faster R-CNN可视化——网络模型,图像特征,Loss图,PR曲线"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Caffe版Faster R-CNN可视化——网络模型,图像特征,Loss图,PR曲线 | 冲弱's Blog</title>
  




<link rel="dns-prefetch" href="waline-five-pi.vercel.app">
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="冲弱's Blog" type="application/atom+xml">
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">冲弱's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">人生在勤，不索何获</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-comment"><a href="/comment/" rel="section"><i class="fa fa-comment fa-fw"></i>评论</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B"><span class="nav-number">1.</span> <span class="nav-text">可视化网络模型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Netscope"><span class="nav-number">1.1.</span> <span class="nav-text">Netscope</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#draw-net-py"><span class="nav-number">1.2.</span> <span class="nav-text">draw_net.py</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96%E5%9B%BE%E5%83%8F%E7%89%B9%E5%BE%81"><span class="nav-number">2.</span> <span class="nav-text">可视化图像特征</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9demo-py"><span class="nav-number">2.1.</span> <span class="nav-text">修改demo.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#deep-visualization-toolbox"><span class="nav-number">2.2.</span> <span class="nav-text">deep-visualization-toolbox</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Loss%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="nav-number">3.</span> <span class="nav-text">Loss可视化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%BBPR%E5%9B%BE"><span class="nav-number">4.</span> <span class="nav-text">画PR图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="nav-number">5.</span> <span class="nav-text">参考文献</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="冲弱"
      src="https://myblog-1258449291.cos.ap-beijing.myqcloud.com/%E6%B4%BE%E5%A4%A7%E6%98%9F.png">
  <p class="site-author-name" itemprop="name">冲弱</p>
  <div class="site-description" itemprop="description">输出即获得，分享即反哺</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">32</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:ouyang-sz@foxmail.com" title="E-Mail → mailto:ouyang-sz@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://juejin.im/user/5ae26032f265da0b9f3ffeb2" title="掘金 → https:&#x2F;&#x2F;juejin.im&#x2F;user&#x2F;5ae26032f265da0b9f3ffeb2" rel="noopener" target="_blank"><i class="fa fa-spinner fa-fw"></i>掘金</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/ou-yang-shi-zhuang/activities" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;ou-yang-shi-zhuang&#x2F;activities" rel="noopener" target="_blank"><i class="fab fa-zhihu fa-fw"></i>知乎</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://oysz2016.github.io/post/79a2296e.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://myblog-1258449291.cos.ap-beijing.myqcloud.com/%E6%B4%BE%E5%A4%A7%E6%98%9F.png">
      <meta itemprop="name" content="冲弱">
      <meta itemprop="description" content="输出即获得，分享即反哺">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="冲弱's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Caffe版Faster R-CNN可视化——网络模型,图像特征,Loss图,PR曲线
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-04-27 12:35:20" itemprop="dateCreated datePublished" datetime="2018-04-27T12:35:20+08:00">2018-04-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2019-03-17 13:48:34" itemprop="dateModified" datetime="2019-03-17T13:48:34+08:00">2019-03-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">深度学习笔记</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/post/79a2296e.html#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/post/79a2296e.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="可视化网络模型"><a href="#可视化网络模型" class="headerlink" title="可视化网络模型"></a>可视化网络模型</h2><p>&emsp;&emsp;Caffe目前有两种常用的可视化模型方式：</p>
<ul>
<li>使用Netscope在线可视化</li>
<li>Caffe代码包内置的draw_net.py文件可以可视化网络模型</li>
</ul>
<span id="more"></span>
<h3 id="Netscope"><a href="#Netscope" class="headerlink" title="Netscope"></a>Netscope</h3><p>&emsp;&emsp;Netscope能可视化神经网络体系结构（或技术上说，Netscope能可视化任何有向无环图）。目前Netscope能可视化Caffe的prototxt 文件。网址为：<br><a target="_blank" rel="noopener" href="http://ethereon.github.io/netscope/#/editor">http://ethereon.github.io/netscope/#/editor</a><br>&emsp;&emsp;Netscope的使用非常简单，只需要将prototxt的文件复制到Netscope的编辑框，再按快捷键Shift+Enter即可得到网络模型的可视化结构。Netscope的优点是显示的网络模型简洁，而且将鼠标放在右侧可视化的网络模型的任意模块上，会显示该模块的具体参数。图1以Faster R-CNN中ZF模型的train.prototxt文件为例</p>
<p><img data-src="https://user-gold-cdn.xitu.io/2018/4/27/163055f07a98ecf7?w=1913&amp;h=891&amp;f=png&amp;s=117701" alt="图1 Netscope可视化ZF网络模型"></p>
<div align = center>图1 Netscope可视化ZF网络模</div>

<h3 id="draw-net-py"><a href="#draw-net-py" class="headerlink" title="draw_net.py"></a>draw_net.py</h3><p>&emsp;&emsp;draw_net.py同样是将prototxt绘制成网络模型，在绘制之前，需要安装两个依赖库：</p>
<blockquote>
<p>1、安装ＧraphViz<br>　　# sudo apt-get install GraphViz<br>　　注意，这里用的是apt-get来安装，而不是pip.<br>2 、安装pydot<br>　　# sudo pip install pydot<br>　　用的是pip来安装，而不是apt-get</p>
</blockquote>
<p>&emsp;&emsp;安装完毕后，即可调用draw_net.py绘制网络模型，如绘制caffe自带的LeNet网络模型：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo python python/draw_net<span class="selector-class">.py</span> examples/mnist/lenet_train_test<span class="selector-class">.prototxt</span> netImage/lenet<span class="selector-class">.png</span> <span class="attr">--rankdir</span>=TB</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;其中有三个参数，各自的含义为：</p>
<blockquote>
<p>第一个参数：网络模型的prototxt文件<br>第二个参数：保存的图片路径及名字<br>第二个参数：–rankdir=x , x 有四种选项，分别是LR, RL, TB, BT 。用来表示网络的方向，分别是从左到右，从右到左，从上到小，从下到上。默认为ＬＲ。</p>
</blockquote>
<p>&emsp;&emsp;可视化结果如下图所示：</p>
<p><img data-src="https://user-gold-cdn.xitu.io/2018/4/27/163055f0793044ea?w=654&amp;h=1669&amp;f=png&amp;s=95256" alt="图2 draw_net.py可视化LeNet网络模型 "></p>
<div align = center>图2 draw_net.py可视化LeNet网络模型</div>



<h2 id="可视化图像特征"><a href="#可视化图像特征" class="headerlink" title="可视化图像特征"></a>可视化图像特征</h2><p>&emsp;&emsp;关于图像的可视化，我也使用过两种两种方式：</p>
<ul>
<li>修改demo.py代码输出中间层结果</li>
<li>使用可视化工具deep-visualization-toolbox</li>
</ul>
<h3 id="修改demo-py"><a href="#修改demo-py" class="headerlink" title="修改demo.py"></a>修改demo.py</h3><p>&emsp;&emsp;该部分是参考薛开宇的《caffe学习笔记》中的<code>逐层特征可视化</code>部分，还是以ZFNet网络训练Pascal VOC为例，修改demo.py文件后，代码如下：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line">#-*-coding:utf-<span class="number">8</span>-*-</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import matplotlib</span><br><span class="line">matplotlib<span class="selector-class">.use</span>(<span class="string">&#x27;Agg&#x27;</span>)</span><br><span class="line">import _init_paths</span><br><span class="line">from fast_rcnn<span class="selector-class">.config</span> import cfg</span><br><span class="line">from fast_rcnn<span class="selector-class">.test</span> import im_detect</span><br><span class="line">from fast_rcnn<span class="selector-class">.nms_wrapper</span> import nms</span><br><span class="line">from utils<span class="selector-class">.timer</span> import Timer</span><br><span class="line">import matplotlib<span class="selector-class">.pyplot</span> as plt</span><br><span class="line">import numpy as np</span><br><span class="line">import scipy<span class="selector-class">.io</span> as sio</span><br><span class="line">import caffe, os, sys, cv2</span><br><span class="line">import argparse</span><br><span class="line"></span><br><span class="line">CLASSES = (<span class="string">&#x27;__background__&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;aeroplane&#x27;</span>, <span class="string">&#x27;bicycle&#x27;</span>, <span class="string">&#x27;bird&#x27;</span>, <span class="string">&#x27;boat&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;bottle&#x27;</span>, <span class="string">&#x27;bus&#x27;</span>, <span class="string">&#x27;car&#x27;</span>, <span class="string">&#x27;cat&#x27;</span>, <span class="string">&#x27;chair&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;cow&#x27;</span>, <span class="string">&#x27;diningtable&#x27;</span>, <span class="string">&#x27;dog&#x27;</span>, <span class="string">&#x27;horse&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;motorbike&#x27;</span>, <span class="string">&#x27;person&#x27;</span>, <span class="string">&#x27;pottedplant&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;sheep&#x27;</span>, <span class="string">&#x27;sofa&#x27;</span>, <span class="string">&#x27;train&#x27;</span>, <span class="string">&#x27;tvmonitor&#x27;</span>)</span><br><span class="line"></span><br><span class="line">NETS = &#123;<span class="string">&#x27;vgg16&#x27;</span>: (<span class="string">&#x27;VGG16&#x27;</span>,</span><br><span class="line">                  <span class="string">&#x27;VGG16_faster_rcnn_final.caffemodel&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;zf&#x27;</span>: (<span class="string">&#x27;ZF&#x27;</span>,</span><br><span class="line">                  <span class="string">&#x27;zf_faster_rcnn_iter_2000.caffemodel&#x27;</span>)&#125;</span><br><span class="line"></span><br><span class="line">def <span class="built_in">vis_detections</span>(im, class_name, dets, thresh=<span class="number">0.5</span>):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;Draw detected bounding boxes.&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    inds = np<span class="selector-class">.where</span>(dets<span class="selector-attr">[:, -1]</span> &gt;= thresh)<span class="selector-attr">[0]</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(inds) == <span class="number">0</span>:</span><br><span class="line">        return</span><br><span class="line"></span><br><span class="line">    im = im<span class="selector-attr">[:, :, (2, 1, 0)]</span></span><br><span class="line">    fig, ax = plt<span class="selector-class">.subplots</span>(figsize=(<span class="number">12</span>, <span class="number">12</span>))</span><br><span class="line">    ax<span class="selector-class">.imshow</span>(im, aspect=<span class="string">&#x27;equal&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> <span class="selector-tag">i</span> <span class="keyword">in</span> inds:</span><br><span class="line">        bbox = dets<span class="selector-attr">[i, :4]</span></span><br><span class="line">        score = dets<span class="selector-attr">[i, -1]</span></span><br><span class="line"></span><br><span class="line">        ax<span class="selector-class">.add_patch</span>(</span><br><span class="line">            plt<span class="selector-class">.Rectangle</span>((bbox<span class="selector-attr">[0]</span>, bbox<span class="selector-attr">[1]</span>),</span><br><span class="line">                          bbox<span class="selector-attr">[2]</span> - bbox<span class="selector-attr">[0]</span>,</span><br><span class="line">                          bbox<span class="selector-attr">[3]</span> - bbox<span class="selector-attr">[1]</span>, fill=False,</span><br><span class="line">                          edgecolor=<span class="string">&#x27;red&#x27;</span>, linewidth=<span class="number">3.5</span>)</span><br><span class="line">            )</span><br><span class="line">        ax<span class="selector-class">.text</span>(bbox<span class="selector-attr">[0]</span>, bbox<span class="selector-attr">[1]</span> - <span class="number">2</span>,</span><br><span class="line">                <span class="string">&#x27;&#123;:s&#125; &#123;:.3f&#125;&#x27;</span><span class="selector-class">.format</span>(class_name, score),</span><br><span class="line">                bbox=<span class="built_in">dict</span>(facecolor=<span class="string">&#x27;blue&#x27;</span>, alpha=<span class="number">0.5</span>),</span><br><span class="line">                fontsize=<span class="number">14</span>, <span class="attribute">color</span>=<span class="string">&#x27;white&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    ax<span class="selector-class">.set_title</span>((<span class="string">&#x27;&#123;&#125; detections with &#x27;</span></span><br><span class="line">                  <span class="string">&#x27;p(&#123;&#125; | box) &gt;= &#123;:.1f&#125;&#x27;</span>)<span class="selector-class">.format</span>(class_name, class_name,</span><br><span class="line">                                                  thresh),</span><br><span class="line">                  fontsize=<span class="number">14</span>)</span><br><span class="line">    plt<span class="selector-class">.axis</span>(<span class="string">&#x27;off&#x27;</span>)</span><br><span class="line">    plt<span class="selector-class">.tight_layout</span>()</span><br><span class="line">    plt<span class="selector-class">.draw</span>()</span><br><span class="line"></span><br><span class="line">def <span class="built_in">demo</span>(net, image_name):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;Detect object classes in an image using pre-computed object proposals.&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    # Load the demo image</span><br><span class="line">    im_file = os<span class="selector-class">.path</span><span class="selector-class">.join</span>(cfg<span class="selector-class">.DATA_DIR</span>, <span class="string">&#x27;demo&#x27;</span>, image_name)</span><br><span class="line">    im = cv2<span class="selector-class">.imread</span>(im_file)</span><br><span class="line"></span><br><span class="line">    # Detect <span class="attribute">all</span> object classes and regress object bounds</span><br><span class="line">    timer = <span class="built_in">Timer</span>()</span><br><span class="line">    timer<span class="selector-class">.tic</span>()</span><br><span class="line">    scores, boxes = <span class="built_in">im_detect</span>(net, im)</span><br><span class="line">    timer<span class="selector-class">.toc</span>()</span><br><span class="line">    print (<span class="string">&#x27;Detection took &#123;:.3f&#125;s for &#x27;</span></span><br><span class="line">           <span class="string">&#x27;&#123;:d&#125; object proposals&#x27;</span>)<span class="selector-class">.format</span>(timer<span class="selector-class">.total_time</span>, boxes<span class="selector-class">.shape</span><span class="selector-attr">[0]</span>)</span><br><span class="line"></span><br><span class="line">    # Visualize detections <span class="keyword">for</span> each class</span><br><span class="line">    CONF_THRESH = <span class="number">0.8</span></span><br><span class="line">    NMS_THRESH = <span class="number">0.3</span></span><br><span class="line">    <span class="keyword">for</span> cls_ind, cls <span class="keyword">in</span> <span class="built_in">enumerate</span>(CLASSES<span class="selector-attr">[1:]</span>):</span><br><span class="line">        cls_ind += <span class="number">1</span> # because we skipped <span class="attribute">background</span></span><br><span class="line">        cls_boxes = boxes<span class="selector-attr">[:, 4*cls_ind:4*(cls_ind + 1)]</span></span><br><span class="line">        cls_scores = scores<span class="selector-attr">[:, cls_ind]</span></span><br><span class="line">        dets = np<span class="selector-class">.hstack</span>((cls_boxes,</span><br><span class="line">                          cls_scores<span class="selector-attr">[:, np.newaxis]</span>))<span class="selector-class">.astype</span>(np.float32)</span><br><span class="line">        keep = <span class="built_in">nms</span>(dets, NMS_THRESH)</span><br><span class="line">        dets = dets<span class="selector-attr">[keep, :]</span></span><br><span class="line">        <span class="built_in">vis_detections</span>(im, cls, dets, thresh=CONF_THRESH)</span><br><span class="line"></span><br><span class="line">def <span class="built_in">parse_args</span>():</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;Parse input arguments.&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    parser = argparse<span class="selector-class">.ArgumentParser</span>(description=<span class="string">&#x27;Faster R-CNN demo&#x27;</span>)</span><br><span class="line">    parser<span class="selector-class">.add_argument</span>(<span class="string">&#x27;--gpu&#x27;</span>, dest=<span class="string">&#x27;gpu_id&#x27;</span>, help=<span class="string">&#x27;GPU device id to use [0]&#x27;</span>,</span><br><span class="line">                        default=<span class="number">0</span>, type=int)</span><br><span class="line">    parser<span class="selector-class">.add_argument</span>(<span class="string">&#x27;--cpu&#x27;</span>, dest=<span class="string">&#x27;cpu_mode&#x27;</span>,</span><br><span class="line">                        help=<span class="string">&#x27;Use CPU mode (overrides --gpu)&#x27;</span>,</span><br><span class="line">                        action=<span class="string">&#x27;store_true&#x27;</span>)</span><br><span class="line">    parser<span class="selector-class">.add_argument</span>(<span class="string">&#x27;--net&#x27;</span>, dest=<span class="string">&#x27;demo_net&#x27;</span>, help=<span class="string">&#x27;Network to use [zf]&#x27;</span>,</span><br><span class="line">                        choices=NETS<span class="selector-class">.keys</span>(), default=<span class="string">&#x27;zf&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    args = parser<span class="selector-class">.parse_args</span>()</span><br><span class="line"></span><br><span class="line">    return args</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    cfg<span class="selector-class">.TEST</span><span class="selector-class">.HAS_RPN</span> = True  # Use RPN <span class="keyword">for</span> proposals</span><br><span class="line"></span><br><span class="line">    args = <span class="built_in">parse_args</span>()</span><br><span class="line">    prototxt = os<span class="selector-class">.path</span><span class="selector-class">.join</span>(cfg<span class="selector-class">.MODELS_DIR</span>, NETS<span class="selector-attr">[args.demo_net]</span><span class="selector-attr">[0]</span>,</span><br><span class="line">                            <span class="string">&#x27;faster_rcnn_alt_opt&#x27;</span>, <span class="string">&#x27;faster_rcnn_test.pt&#x27;</span>)</span><br><span class="line">    caffemodel = os<span class="selector-class">.path</span><span class="selector-class">.join</span>(cfg<span class="selector-class">.DATA_DIR</span>, <span class="string">&#x27;faster_rcnn_models&#x27;</span>,</span><br><span class="line">                              NETS<span class="selector-attr">[args.demo_net]</span><span class="selector-attr">[1]</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> not os<span class="selector-class">.path</span><span class="selector-class">.isfile</span>(caffemodel):</span><br><span class="line">        raise <span class="built_in">IOError</span>((<span class="string">&#x27;&#123;:s&#125; not found.\nDid you run ./data/script/&#x27;</span></span><br><span class="line">                       <span class="string">&#x27;fetch_faster_rcnn_models.sh?&#x27;</span>)<span class="selector-class">.format</span>(caffemodel))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> args<span class="selector-class">.cpu_mode</span>:</span><br><span class="line">        caffe<span class="selector-class">.set_mode_cpu</span>()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        caffe<span class="selector-class">.set_mode_gpu</span>()</span><br><span class="line">        caffe<span class="selector-class">.set_device</span>(args.gpu_id)</span><br><span class="line">        cfg<span class="selector-class">.GPU_ID</span> = args<span class="selector-class">.gpu_id</span></span><br><span class="line">    net = caffe<span class="selector-class">.Net</span>(prototxt, caffemodel, caffe.TEST)</span><br><span class="line">	#指定caffe路径，以下是我的caffe路径 </span><br><span class="line">    caffe_root=<span class="string">&#x27;/home/ouyang/GitRepository/py-faster-rcnn/caffe-fast-rcnn/&#x27;</span></span><br><span class="line">    # import sys</span><br><span class="line">    sys<span class="selector-class">.path</span><span class="selector-class">.insert</span>(<span class="number">0</span>, caffe_root+<span class="string">&#x27;python&#x27;</span>)</span><br><span class="line">    # import caffe</span><br><span class="line"></span><br><span class="line">    # #显示的图表大小为 <span class="number">10</span>,图形的插值是以最近为原则,图像颜色是灰色</span><br><span class="line">    plt<span class="selector-class">.rcParams</span><span class="selector-attr">[<span class="string">&#x27;figure.figsize&#x27;</span>]</span> = (<span class="number">10</span>, <span class="number">10</span>)</span><br><span class="line">    plt<span class="selector-class">.rcParams</span><span class="selector-attr">[<span class="string">&#x27;image.interpolation&#x27;</span>]</span> = <span class="string">&#x27;nearest&#x27;</span></span><br><span class="line">    plt<span class="selector-class">.rcParams</span><span class="selector-attr">[<span class="string">&#x27;image.cmap&#x27;</span>]</span> = <span class="string">&#x27;gray&#x27;</span></span><br><span class="line">    image_file = caffe_root+<span class="string">&#x27;examples/images/vehicle_0000015.jpg&#x27;</span>  </span><br><span class="line">    # 载入模型</span><br><span class="line">    npload = caffe_root+ <span class="string">&#x27;python/caffe/imagenet/ilsvrc_2012_mean.npy&#x27;</span>  </span><br><span class="line">    </span><br><span class="line">    transformer = caffe<span class="selector-class">.io</span><span class="selector-class">.Transformer</span>(&#123;<span class="string">&#x27;data&#x27;</span>: net<span class="selector-class">.blobs</span><span class="selector-attr">[<span class="string">&#x27;data&#x27;</span>]</span><span class="selector-class">.data</span>.shape&#125;)</span><br><span class="line">    transformer<span class="selector-class">.set_transpose</span>(<span class="string">&#x27;data&#x27;</span>, (<span class="number">2</span>,<span class="number">0</span>,<span class="number">1</span>))</span><br><span class="line">    transformer<span class="selector-class">.set_mean</span>(<span class="string">&#x27;data&#x27;</span>, np<span class="selector-class">.load</span>(npload)<span class="selector-class">.mean</span>(<span class="number">1</span>)<span class="selector-class">.mean</span>(<span class="number">1</span>))</span><br><span class="line">    # 参考模型的灰度为<span class="number">0</span>~<span class="number">255</span>，而不是<span class="number">0</span>~<span class="number">1</span></span><br><span class="line">    transformer<span class="selector-class">.set_raw_scale</span>(<span class="string">&#x27;data&#x27;</span>, <span class="number">255</span>) </span><br><span class="line">    # 由于参考模型色彩是BGR,需要将其转换为RGB</span><br><span class="line">    transformer<span class="selector-class">.set_channel_swap</span>(<span class="string">&#x27;data&#x27;</span>, (<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>))</span><br><span class="line">    im=caffe<span class="selector-class">.io</span><span class="selector-class">.load_image</span>(image_file)</span><br><span class="line">    net<span class="selector-class">.blobs</span><span class="selector-attr">[<span class="string">&#x27;data&#x27;</span>]</span><span class="selector-class">.reshape</span>(<span class="number">1</span>,<span class="number">3</span>,<span class="number">224</span>,<span class="number">224</span>)</span><br><span class="line">    net<span class="selector-class">.blobs</span><span class="selector-attr">[<span class="string">&#x27;data&#x27;</span>]</span><span class="selector-class">.data</span><span class="selector-attr">[...]</span> = transformer<span class="selector-class">.preprocess</span>(<span class="string">&#x27;data&#x27;</span>,im)</span><br><span class="line">    # 显示出各层的参数和形状，第一个是批次，第二个是feature map数目，第三和第四是每个神经元中图片的长和宽</span><br><span class="line">    print <span class="selector-attr">[(k,v.data.shape) for k,v in net.blobs.items()]</span></span><br><span class="line">    #输出网络参数</span><br><span class="line">    print <span class="selector-attr">[(k,v[0]</span><span class="selector-class">.data</span>.shape) <span class="keyword">for</span> k,v <span class="keyword">in</span> net<span class="selector-class">.params</span><span class="selector-class">.items</span>()]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">    def <span class="built_in">show_image</span>(im):</span><br><span class="line">        <span class="keyword">if</span> im.ndim==<span class="number">3</span>:</span><br><span class="line">            m=im<span class="selector-attr">[:,:,::-1]</span></span><br><span class="line">        plt<span class="selector-class">.imshow</span>(im)</span><br><span class="line">        #显示图片的方法</span><br><span class="line">        plt<span class="selector-class">.axis</span>(<span class="string">&#x27;off&#x27;</span>) # 不显示坐标轴</span><br><span class="line">        plt<span class="selector-class">.show</span>()    </span><br><span class="line"></span><br><span class="line">    # 每个可视化的都是在一个由一个个网格组成</span><br><span class="line">    def <span class="built_in">vis_square</span>(data,padsize=<span class="number">1</span>,padval=<span class="number">0</span>):</span><br><span class="line">        data-=data<span class="selector-class">.min</span>()</span><br><span class="line">        data/=data<span class="selector-class">.max</span>()</span><br><span class="line">        </span><br><span class="line">        # force the number of filters to be square</span><br><span class="line">        n=<span class="built_in">int</span>(np<span class="selector-class">.ceil</span>(np<span class="selector-class">.sqrt</span>(data<span class="selector-class">.shape</span><span class="selector-attr">[0]</span>)))</span><br><span class="line">        <span class="attribute">padding</span>=((<span class="number">0</span>,n**<span class="number">2</span>-data.shape[<span class="number">0</span>]),(<span class="number">0</span>,padsize),(<span class="number">0</span>,padsize))+((<span class="number">0</span>,<span class="number">0</span>),)*(data.ndim-<span class="number">3</span>)</span><br><span class="line">        data=np<span class="selector-class">.pad</span>(data,<span class="attribute">padding</span>,mode=<span class="string">&#x27;constant&#x27;</span>,constant_values=(padval,padval))</span><br><span class="line">        # 对图像使用滤波器</span><br><span class="line">        </span><br><span class="line">        data=data<span class="selector-class">.reshape</span>((n,n)+data<span class="selector-class">.shape</span><span class="selector-attr">[1:]</span>)<span class="selector-class">.transpose</span>((<span class="number">0</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">3</span>)+<span class="built_in">tuple</span>(<span class="built_in">range</span>( <span class="number">4</span>,data.ndim+<span class="number">1</span>)))</span><br><span class="line">        data=data<span class="selector-class">.reshape</span>((n*data<span class="selector-class">.shape</span><span class="selector-attr">[1]</span>,n*data<span class="selector-class">.shape</span><span class="selector-attr">[3]</span>)+data<span class="selector-class">.shape</span><span class="selector-attr">[4:]</span>)   </span><br><span class="line">        </span><br><span class="line">        <span class="selector-id">#show_image</span>(data)</span><br><span class="line">        plt<span class="selector-class">.imshow</span>(data)</span><br><span class="line">        plt<span class="selector-class">.show</span>()</span><br><span class="line">        # 设置图片的保存路径，此处是我的路径</span><br><span class="line">        plt<span class="selector-class">.savefig</span>(<span class="string">&quot;./tools/Vehicle_2000/fc6.jpg&quot;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    out = net<span class="selector-class">.forward</span>()</span><br><span class="line">    image=net<span class="selector-class">.blobs</span><span class="selector-attr">[<span class="string">&#x27;data&#x27;</span>]</span><span class="selector-class">.data</span><span class="selector-attr">[4]</span><span class="selector-class">.copy</span>()</span><br><span class="line">    image-=image<span class="selector-class">.min</span>()</span><br><span class="line">    image/=image<span class="selector-class">.max</span>()</span><br><span class="line">    # 显示原始图像</span><br><span class="line">    <span class="built_in">show_image</span>(image<span class="selector-class">.transpose</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">0</span>))</span><br><span class="line">    #网络提取conv1的卷积核</span><br><span class="line">    filters = net<span class="selector-class">.params</span><span class="selector-attr">[<span class="string">&#x27;conv1&#x27;</span>]</span><span class="selector-attr">[0]</span><span class="selector-class">.data</span></span><br><span class="line">    <span class="built_in">vis_square</span>(filters<span class="selector-class">.transpose</span>(<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>))</span><br><span class="line">    #过滤后的输出,<span class="number">96</span> 张 featuremap</span><br><span class="line">    feat =net<span class="selector-class">.blobs</span><span class="selector-attr">[<span class="string">&#x27;conv1&#x27;</span>]</span><span class="selector-class">.data</span><span class="selector-attr">[0,:96]</span></span><br><span class="line">    <span class="built_in">vis_square</span>(feat,padval=<span class="number">1</span>)</span><br><span class="line">    #第二个卷积层,显示全部的<span class="number">96</span>个滤波器,每一个滤波器为一行。</span><br><span class="line">    filters = net<span class="selector-class">.params</span><span class="selector-attr">[<span class="string">&#x27;conv2&#x27;</span>]</span><span class="selector-attr">[0]</span><span class="selector-class">.data</span></span><br><span class="line">    <span class="built_in">vis_square</span>(filters<span class="selector-attr">[:96]</span><span class="selector-class">.reshape</span>(<span class="number">96</span>**<span class="number">2</span>, <span class="number">5</span>, <span class="number">5</span>))</span><br><span class="line">    # #第二层输出 <span class="number">256</span> 张 featuremap</span><br><span class="line">    feat = net<span class="selector-class">.blobs</span><span class="selector-attr">[<span class="string">&#x27;conv2&#x27;</span>]</span><span class="selector-class">.data</span><span class="selector-attr">[0]</span></span><br><span class="line">    <span class="built_in">vis_square</span>(feat, padval=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    filters = net<span class="selector-class">.params</span><span class="selector-attr">[<span class="string">&#x27;conv3&#x27;</span>]</span><span class="selector-attr">[0]</span><span class="selector-class">.data</span></span><br><span class="line">    <span class="built_in">vis_square</span>(filters<span class="selector-attr">[:256]</span><span class="selector-class">.reshape</span>(<span class="number">256</span>**<span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # 第三个卷积层:全部 <span class="number">384</span> 个 feature map</span><br><span class="line">    feat = net<span class="selector-class">.blobs</span><span class="selector-attr">[<span class="string">&#x27;conv3&#x27;</span>]</span><span class="selector-class">.data</span><span class="selector-attr">[0]</span></span><br><span class="line">    <span class="built_in">vis_square</span>(feat, padval=<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    #第四个卷积层,我们只显示前面 <span class="number">48</span> 个滤波器,每一个滤波器为一行。</span><br><span class="line">    filters = net<span class="selector-class">.params</span><span class="selector-attr">[<span class="string">&#x27;conv4&#x27;</span>]</span><span class="selector-attr">[0]</span><span class="selector-class">.data</span></span><br><span class="line">    <span class="built_in">vis_square</span>(filters<span class="selector-attr">[:384]</span><span class="selector-class">.reshape</span>(<span class="number">384</span>**<span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">    # 第四个卷积层:全部 <span class="number">384</span> 个 feature map</span><br><span class="line">    feat = net<span class="selector-class">.blobs</span><span class="selector-attr">[<span class="string">&#x27;conv4&#x27;</span>]</span><span class="selector-class">.data</span><span class="selector-attr">[0]</span></span><br><span class="line">    <span class="built_in">vis_square</span>(feat, padval=<span class="number">0.5</span>)</span><br><span class="line">    # 第五个卷积层:全部 <span class="number">256</span> 个 feature map</span><br><span class="line">    filters = net<span class="selector-class">.params</span><span class="selector-attr">[<span class="string">&#x27;conv5&#x27;</span>]</span><span class="selector-attr">[0]</span><span class="selector-class">.data</span></span><br><span class="line">    <span class="built_in">vis_square</span>(filters<span class="selector-attr">[:384]</span><span class="selector-class">.reshape</span>(<span class="number">384</span>**<span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">    feat = net<span class="selector-class">.blobs</span><span class="selector-attr">[<span class="string">&#x27;conv5&#x27;</span>]</span><span class="selector-class">.data</span><span class="selector-attr">[0]</span></span><br><span class="line">    <span class="built_in">vis_square</span>(feat, padval=<span class="number">0.5</span>)</span><br><span class="line">    #第五个 pooling 层</span><br><span class="line">    feat = net<span class="selector-class">.blobs</span><span class="selector-attr">[<span class="string">&#x27;fc6&#x27;</span>]</span><span class="selector-class">.data</span><span class="selector-attr">[0]</span></span><br><span class="line">    <span class="built_in">vis_square</span>(feat, padval=<span class="number">1</span>)</span><br><span class="line">    第六层输出后的直方分布</span><br><span class="line">    feat=net<span class="selector-class">.blobs</span><span class="selector-attr">[<span class="string">&#x27;fc6&#x27;</span>]</span><span class="selector-class">.data</span><span class="selector-attr">[0]</span></span><br><span class="line">    plt<span class="selector-class">.subplot</span>(<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">    plt<span class="selector-class">.plot</span>(feat.flat)</span><br><span class="line">    plt<span class="selector-class">.subplot</span>(<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">    _=plt<span class="selector-class">.hist</span>(feat<span class="selector-class">.flat</span><span class="selector-attr">[feat.flat&gt;0]</span>,bins=<span class="number">100</span>)</span><br><span class="line">    # #显示图片的方法</span><br><span class="line">    <span class="selector-id">#plt</span><span class="selector-class">.axis</span>(<span class="string">&#x27;off&#x27;</span>) # 不显示坐标轴</span><br><span class="line">    plt<span class="selector-class">.show</span>()  </span><br><span class="line">    plt<span class="selector-class">.savefig</span>(<span class="string">&quot;fc6_zhifangtu.jpg&quot;</span>) </span><br><span class="line">    # 第七层输出后的直方分布</span><br><span class="line">    feat=net<span class="selector-class">.blobs</span><span class="selector-attr">[<span class="string">&#x27;fc7&#x27;</span>]</span><span class="selector-class">.data</span><span class="selector-attr">[0]</span></span><br><span class="line">    plt<span class="selector-class">.subplot</span>(<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">    plt<span class="selector-class">.plot</span>(feat.flat)</span><br><span class="line">    plt<span class="selector-class">.subplot</span>(<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">    _=plt<span class="selector-class">.hist</span>(feat<span class="selector-class">.flat</span><span class="selector-attr">[feat.flat&gt;0]</span>,bins=<span class="number">100</span>)</span><br><span class="line">    plt<span class="selector-class">.show</span>()</span><br><span class="line">    plt<span class="selector-class">.savefig</span>(<span class="string">&quot;fc7_zhifangtu.jpg&quot;</span>) </span><br><span class="line">    #看标签</span><br><span class="line">    #执行测试  </span><br><span class="line">    image_labels_filename=caffe_root+<span class="string">&#x27;data/ilsvrc12/synset_words.txt&#x27;</span></span><br><span class="line">    <span class="selector-id">#try</span>:</span><br><span class="line">    labels=np<span class="selector-class">.loadtxt</span>(image_labels_filename,str,delimiter=<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">    top_k=net<span class="selector-class">.blobs</span><span class="selector-attr">[<span class="string">&#x27;prob&#x27;</span>]</span><span class="selector-class">.data</span><span class="selector-attr">[0]</span><span class="selector-class">.flatten</span>()<span class="selector-class">.argsort</span>()<span class="selector-attr">[-1:-6:-1]</span></span><br><span class="line">    <span class="selector-id">#print</span> labels<span class="selector-attr">[top_k]</span></span><br><span class="line">    <span class="keyword">for</span> <span class="selector-tag">i</span> <span class="keyword">in</span> np<span class="selector-class">.arange</span>(top_k.size):</span><br><span class="line">        print top_k<span class="selector-attr">[i]</span>, labels<span class="selector-attr">[top_k[i]</span>]</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;下面贴几张检测结果</p>
<p><img data-src="https://user-gold-cdn.xitu.io/2018/4/27/163055f07a3eac7e?w=466&amp;h=357&amp;f=jpeg&amp;s=27803" alt="图3 原始检测图片"></p>
<div align = center>图3 原始检测图片</div>

<p><img data-src="https://user-gold-cdn.xitu.io/2018/4/27/163055f07a4a0941?w=1000&amp;h=1000&amp;f=jpeg&amp;s=168164" alt="图4 conv1参数可视化"></p>
<div align = center>图4 conv1参数可视化</div>

<p><img data-src="https://user-gold-cdn.xitu.io/2018/4/27/163055f0795032db?w=1000&amp;h=1000&amp;f=jpeg&amp;s=314989" alt="图5 conv1特征可视化"></p>
<div align = center>图5 conv1特征可视化</div>

<h3 id="deep-visualization-toolbox"><a href="#deep-visualization-toolbox" class="headerlink" title="deep-visualization-toolbox"></a>deep-visualization-toolbox</h3><p>&emsp;&emsp;deep-visualization-toolbox是Jason Yosinsk出版在Computer Science上的一篇论文的源代码，改论文主要讲述的是卷积神经网络的可视化，感兴趣的朋友可以看看这篇论文（<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/1506.06579.pdf">论文地址</a>）。B站上有个讲怎么使用该工具的视频，这里附上链接<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av7405645/">https://www.bilibili.com/video/av7405645/</a>。<br>&emsp;&emsp;该工具的源码在github：<a target="_blank" rel="noopener" href="https://github.com/yosinski/deep-visualization-toolbox">https://github.com/yosinski/deep-visualization-toolbox</a>。该github下有完整的安装配置步骤，还是以图2中的马为例，贴几张检测结果图。</p>
<p><img data-src="https://user-gold-cdn.xitu.io/2018/4/27/163055f07aab31b9?w=1920&amp;h=1080&amp;f=png&amp;s=1096956" alt="图6 ToolBox conv1特征可视化"></p>
<div align = center>图6 ToolBox conv1特征可视化</div>

<p><img data-src="https://user-gold-cdn.xitu.io/2018/4/27/163055f0a7aac1ec?w=1920&amp;h=1080&amp;f=png&amp;s=1019414" alt="图7 ToolBox conv2特征可视化"></p>
<div align = center>图7 ToolBox conv2特征可视化</div>

<p>&emsp;&emsp;从检测效果上看，还是挺简洁的。图片左侧的一列图片左上角是输入图片，中间部分是图片经过网络前向传播得到的特征图可视化，左下角是其特征可视化。</p>
<h2 id="Loss可视化"><a href="#Loss可视化" class="headerlink" title="Loss可视化"></a>Loss可视化</h2><p>&emsp;&emsp;网络训练过程中Loss值的可视化可以帮助分析该网络模型的参数是否合适。在使用Faster R-CNN网络训练模型时，训练完成后的日志文件中保存了网络训练各个阶段的loss值，如图8所示。只用写简单的python程序，读取日志文件中的迭代次数，以及需要的损失值，再画图即可完成Loss的可视化。</p>
<p><img data-src="https://myblog-1258449291.cos.ap-beijing.myqcloud.com/Blog/日志图片.png-chuli" alt="图8 模型的训练日志"></p>
<div align = center>图8 模型的训练日志</div>
&emsp;&emsp;在下面贴出Loss可视化的代码：

<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python  </span><br><span class="line">import os  </span><br><span class="line">import sys  </span><br><span class="line">import numpy as np  </span><br><span class="line">import matplotlib<span class="selector-class">.pyplot</span> as plt  </span><br><span class="line">import math  </span><br><span class="line">import re  </span><br><span class="line">import pylab  </span><br><span class="line">from pylab import <span class="selector-tag">figure</span>, show, <span class="selector-tag">legend</span>  </span><br><span class="line">from mpl_toolkits<span class="selector-class">.axes_grid1</span> import host_subplot  </span><br><span class="line">  </span><br><span class="line"># 日志文件名</span><br><span class="line">fp = <span class="built_in">open</span>(<span class="string">&#x27;faster_rcnn_end2end_ZF_.txt.2018-04-13_19-46-23&#x27;</span>, <span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;UTF-8&#x27;</span>) </span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">train_iterations = <span class="selector-attr">[]</span>  </span><br><span class="line">train_loss = <span class="selector-attr">[]</span>  </span><br><span class="line">test_iterations = <span class="selector-attr">[]</span>  </span><br><span class="line"><span class="selector-id">#test_accuracy</span> = <span class="selector-attr">[]</span>  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> ln <span class="keyword">in</span> fp:  </span><br><span class="line">  # get train_iterations and train_loss  </span><br><span class="line">  <span class="keyword">if</span> <span class="string">&#x27;] Iteration &#x27;</span> <span class="keyword">in</span> ln and <span class="string">&#x27;loss = &#x27;</span> <span class="keyword">in</span> ln:  </span><br><span class="line">    arr = re<span class="selector-class">.findall</span>(r<span class="string">&#x27;ion \b\d+\b,&#x27;</span>,ln)  </span><br><span class="line">    train_iterations<span class="selector-class">.append</span>(<span class="built_in">int</span>(arr<span class="selector-attr">[0]</span><span class="selector-class">.strip</span>(<span class="string">&#x27;,&#x27;</span>)<span class="selector-attr">[4:]</span>))  </span><br><span class="line">    train_loss<span class="selector-class">.append</span>(<span class="attribute">float</span>(ln.<span class="built_in">strip</span>().<span class="built_in">split</span>(<span class="string">&#x27; = &#x27;</span>)[-<span class="number">1</span>]))  </span><br><span class="line">      </span><br><span class="line">fp<span class="selector-class">.close</span>()  </span><br><span class="line">  </span><br><span class="line">host = <span class="built_in">host_subplot</span>(<span class="number">111</span>)  </span><br><span class="line">plt<span class="selector-class">.subplots_adjust</span>(<span class="attribute">right</span>=<span class="number">0.8</span>) # ajust the right boundary of the plot window  </span><br><span class="line"><span class="selector-id">#par1</span> = host<span class="selector-class">.twinx</span>()  </span><br><span class="line"># set labels  </span><br><span class="line">host<span class="selector-class">.set_xlabel</span>(<span class="string">&quot;iterations&quot;</span>)  </span><br><span class="line">host<span class="selector-class">.set_ylabel</span>(<span class="string">&quot;RPN loss&quot;</span>)  </span><br><span class="line"><span class="selector-id">#par1</span><span class="selector-class">.set_ylabel</span>(<span class="string">&quot;validation accuracy&quot;</span>)  </span><br><span class="line">  </span><br><span class="line"># plot curves  </span><br><span class="line">p1, = host<span class="selector-class">.plot</span>(train_iterations, train_loss, label=<span class="string">&quot;train RPN loss&quot;</span>)  </span><br><span class="line">.  </span><br><span class="line">host<span class="selector-class">.legend</span>(loc=<span class="number">1</span>)  </span><br><span class="line">  </span><br><span class="line"># set <span class="selector-tag">label</span> <span class="attribute">color</span>  </span><br><span class="line">host<span class="selector-class">.axis</span><span class="selector-attr">[<span class="string">&quot;left&quot;</span>]</span><span class="selector-class">.label</span><span class="selector-class">.set_color</span>(p1<span class="selector-class">.get_color</span>())  </span><br><span class="line">host<span class="selector-class">.set_xlim</span>(<span class="selector-attr">[-1000, 60000]</span>)  </span><br><span class="line">host<span class="selector-class">.set_ylim</span>(<span class="selector-attr">[0., 3.5]</span>)  </span><br><span class="line">  </span><br><span class="line">plt<span class="selector-class">.draw</span>()  </span><br><span class="line">plt<span class="selector-class">.show</span>()  </span><br></pre></td></tr></table></figure>
&emsp;&emsp;可视化效果如下图所示

![图9 Loss可视化](https://myblog-1258449291.cos.ap-beijing.myqcloud.com/Blog/loss可视化.png-chuli)
<div align = center>图9 Loss可视化</div>

<h2 id="画PR图"><a href="#画PR图" class="headerlink" title="画PR图"></a>画PR图</h2><p>&emsp;&emsp;Faster R-CNN训练网络在输出网络模型的同级文件夹里有每一类检测目标每张图片的准确率和召回率，可以绘制准确率召回率(Precision-recall, PR)曲线，PR曲线的面积即准确率的值。<br>&emsp;&emsp;该文件存储在==output\faster_rcnn_end2end\voc_2007_test\zf_faster_rcnn_iter==下的.pkl文件下，需要将其转换为.txt文件。代码如下：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#-*-coding:utf-<span class="number">8</span>-*-</span><br><span class="line">import cPickle as pickle</span><br><span class="line">import numpy as np </span><br><span class="line">np<span class="selector-class">.set_printoptions</span>(threshold=np.NaN) </span><br><span class="line">fr = <span class="built_in">open</span>(<span class="string">&#x27;./aeroplane_pr.pkl&#x27;</span>)    #open的参数是pkl文件的路径</span><br><span class="line">inf = pickle<span class="selector-class">.load</span>(fr)       #读取pkl文件的内容</span><br><span class="line">print inf</span><br><span class="line">fo = <span class="built_in">open</span>(<span class="string">&quot;aeroplane_pr.txt&quot;</span>, <span class="string">&quot;wb&quot;</span>)</span><br><span class="line">fo<span class="selector-class">.write</span>(<span class="built_in">str</span>(inf))</span><br><span class="line">fo<span class="selector-class">.close</span>()</span><br><span class="line">fr<span class="selector-class">.close</span>()                       #关闭文件</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;执行完这个程序后，会将.pkl文件转换为.txt文件保存。.txt文件能直观看到每张图片的检测准确率与召回率。用与画loss图相似的方法，即可完成PR曲线的绘制。效果图如图10所示。</p>
<p><img data-src="https://user-gold-cdn.xitu.io/2018/4/27/163055f0c90ea778?w=800&amp;h=596&amp;f=png&amp;s=20463" alt="图10 PR曲线"></p>
<div align = center>图10 PR曲线</div>

<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>[1] 薛开宇，caffe学习笔记<br>[2] Yosinski J, Clune J, Nguyen A, et al. Understanding Neural Networks Through Deep Visualization[J]. Computer Science, 2015.</p>
<blockquote class="blockquote-center">
<p><strong><font size="5">欢迎关注我的公众号</font></strong></p>

</blockquote>
<p><img data-src="https://blog-1258449291.cos.ap-chengdu.myqcloud.com/小书匠/1552801555033.jpg" alt="enter description here"></p>

    </div>

    
    
    

    <div>
      
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

      
    </div>

    <footer class="post-footer">
          <div class="reward-container">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="https://myblog-1258449291.cos.ap-beijing.myqcloud.com/wechatpay.jpg" alt="冲弱 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="https://myblog-1258449291.cos.ap-beijing.myqcloud.com/alipay.jpg" alt="冲弱 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>原作者： </strong>冲弱
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://oysz2016.github.io/post/79a2296e.html" title="Caffe版Faster R-CNN可视化——网络模型,图像特征,Loss图,PR曲线">https://oysz2016.github.io/post/79a2296e.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="followme">
  <span>欢迎关注我的其它发布渠道</span>

  <div class="social-list">

      <div class="social-item">
        <a target="_blank" class="social-link" href="https://myblog-1258449291.cos.ap-beijing.myqcloud.com/%E5%85%AC%E4%BC%97%E5%8F%B7.jpg">
          <span class="icon">
            <i class="fab fa-weixin"></i>
          </span>

          <span class="label">WeChat</span>
        </a>
      </div>

      <div class="social-item">
        <a target="_blank" class="social-link" href="https://www.zhihu.com/people/ou-yang-shi-zhuang/posts">
          <span class="icon">
            <i class="fab fa-zhihu"></i>
          </span>

          <span class="label">ZhiHu</span>
        </a>
      </div>

      <div class="social-item">
        <a target="_blank" class="social-link" href="https://juejin.cn/user/4353721775688920">
          <span class="icon">
            <i class="fa fa-spinner"></i>
          </span>

          <span class="label">JueJin</span>
        </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" rel="tag"> <i class="fa fa-tag"></i> 深度学习</a>
              <a href="/tags/%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/" rel="tag"> <i class="fa fa-tag"></i> 卷积神经网络</a>
              <a href="/tags/Faster-R-CNN/" rel="tag"> <i class="fa fa-tag"></i> Faster R-CNN</a>
              <a href="/tags/%E5%8F%AF%E8%A7%86%E5%8C%96/" rel="tag"> <i class="fa fa-tag"></i> 可视化</a>
          </div>

        
  <div class="post-widgets">
    <div class="wpac-rating-container">
      <div id="wpac-rating"></div>
    </div>
  </div>

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/d86a012b.html" rel="prev" title="卷积神经网络模型解读汇总——LeNet5，AlexNet、ZFNet、VGG16、GoogLeNet和ResNet">
                  <i class="fa fa-chevron-left"></i> 卷积神经网络模型解读汇总——LeNet5，AlexNet、ZFNet、VGG16、GoogLeNet和ResNet
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/43b16a18.html" rel="next" title="如何阅读一本书">
                  如何阅读一本书 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-waline">waline</a></li>
            <li class="tab"><a href="#comment-livere">livere</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane waline" id="comment-waline">
              <div class="comments" id="waline"></div>
            </div>
            <div class="tab-pane livere" id="comment-livere">
              <div class="comments" id="lv-container" data-id="city" data-uid="MTAyMC8zNTg2Ni8xMjQwMg==
Waline Config File"></div>
            </div>
        </div>
      </div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">冲弱</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">98k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">1:29</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="addthis_inline_share_toolbox">
    <script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5adaebc9009ff58b" async="async"></script>
  </div>
  <div id="site-runtime">
  <span class="post-meta-item-icon">
    <i class="fa fa-clock-o"></i>
  </span>
  <span id="runtime"></span>
</div>

<script language="javascript">
  function isPC() {
    var userAgentInfo = navigator.userAgent;
    var agents = ["Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod"];
    for (var i = 0; i < agents.length; i++) {
      if (userAgentInfo.indexOf(agents[i]) > 0) {
        return false;
      }
    }
    return true;
  }

  function siteTime(openOnPC, start) {
    window.setTimeout("siteTime(openOnPC, start)", 1000);
    var seconds = 1000;
    var minutes = seconds * 60;
    var hours = minutes * 60;
    var days = hours * 24;
    var years = days * 365;
      start = new Date("2019-11-23 09:00:00 +0800");
    var now = new Date();
    var year = now.getFullYear();
    var month = now.getMonth() + 1;
    var date = now.getDate();
    var hour = now.getHours();
    var minute = now.getMinutes();
    var second = now.getSeconds();
    var diff = now - start;

    var diffYears = Math.floor(diff / years);
    var diffDays = Math.floor((diff / days) - diffYears * 365);
    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes * minutes) / seconds);

    if (openOnPC) {
      document.getElementById("runtime").innerHTML = "Running: " + diffYears + " years " + diffDays + " days " + diffHours + " hours " + diffMinutes + " mins " + diffSeconds + " secs";
    } else {
      document.getElementById("runtime").innerHTML = "Running: " + diffYears + "y " + diffDays + "d " + diffHours + "h " + diffMinutes + "m " + diffSeconds + "s";
    }
  }

  var showOnMobile = false;
  var openOnPC = isPC();
  var start = new Date();
  siteTime(openOnPC, start);

  if (!openOnPC && !showOnMobile) {
    document.getElementById('site-runtime').style.display = 'none';
  }
</script>
    </div>
  </footer>

  
  <script size="300" alpha="0.6" zIndex="-1" src="https://cdn.jsdelivr.net/npm/ribbon.js@1.0.2/dist/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/pjax.js"></script>

  
  <script src="https://embed.widgetpack.com/widget.js" async></script>
  <script class="next-config" data-name="rating" type="application/json">{"enable":true,"id":11277,"color":"f79533"}</script>
  <script src="/js/third-party/rating.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.7/pdfobject.min.js","integrity":"sha256-ph3Dk89VmuTVXG6x/RDzk53SU9LPdAh1tpv0UvnDZ2I="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>


  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>

  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"waline-five-pi.vercel.app","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"libUrl":"https://unpkg.com/@waline/client@v2/dist/waline.js","locale":{"placeholder":"Welcome to comment"},"dark":"auto","emoji":["https://unpkg.com/@waline/emojis@1.0.1/weibo","https://unpkg.com/@waline/emojis@1.0.1/alus","https://unpkg.com/@waline/emojis@1.0.1/bilibili","https://unpkg.com/@waline/emojis@1.0.1/qq","https://unpkg.com/@waline/emojis@1.0.1/tieba","https://unpkg.com/@waline/emojis@1.0.1/tw-emoji"],"wordLimit":0,"pageSize":10,"el":"#waline","comment":true,"path":"/post/79a2296e.html"}</script>
<link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css">
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script>
<script src="https://unpkg.com/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '64px',
  right: '32px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#100f2c',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script>
<script src="/js/third-party/comments/livere.js"></script>

</body>
</html>
